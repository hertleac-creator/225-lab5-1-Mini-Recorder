<!doctype html>
<html lang="en" data-bs-theme="auto" id="html-root">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>Warhammer Model Tracker</title>

    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
  </head>
  <body class="bg-dark text-light">
    <div class="container py-4">

      <header class="mb-4 py-3 border-bottom border-secondary">
        <h2 class="text-warning">Warhammer 40,000 Model Tracker</h2>
        <div class="text-secondary small">by Erwin Hertlein</div>
      </header>

      <!-- Flash messages -->
      {% with msgs = get_flashed_messages(with_categories=True) %}
        {% if msgs %}
          <div class="mb-3">
            {% for category, m in msgs %}
              <div class="alert alert-{{ 'success' if category=='success' else 'danger' }}">
                {{ m }}
              </div>
            {% endfor %}
          </div>
        {% endif %}
      {% endwith %}

      <!-- Add Model -->
      <div class="card bg-secondary mb-4">
        <div class="card-body">
          <h4 class="mb-3">Add Warhammer Model</h4>

          <form method="POST" action="{{ url_for('index') }}" class="row g-3">
            <input type="hidden" name="action" value="add">

            <div class="col-md-4">
              <label class="form-label">Model Name</label>
              <input class="form-control" name="model_name" required>
            </div>

            <div class="col-md-4">
              <label class="form-label">Faction</label>
              <input class="form-control" name="faction" required>
            </div>

            <div class="col-md-2">
              <label class="form-label">Painted?</label>
              <select class="form-control" name="painted">
                <option value="0">No</option>
                <option value="1">Yes</option>
              </select>
            </div>

            <div class="col-md-2">
              <label class="form-label">Models Owned</label>
              <input class="form-control" type="number" name="models_owned" value="1" required>
            </div>

            <div class="col-12">
              <button class="btn btn-warning">Add Model</button>
            </div>
          </form>
        </div>
      </div>

      <!-- List Header -->
      <div class="d-flex justify-content-between align-items-center mb-2">
        <h4 class="m-0">All Models</h4>
      </div>

      <!-- Table -->
      <div class="card bg-secondary">
        <div class="table-responsive">
          <table class="table table-dark table-striped table-hover mb-0">
            <thead>
              <tr>
                <th>ID</th>
                <th>Model Name</th>
                <th>Faction</th>
                <th>Painted</th>
                <th>Owned</th>
                <th class="text-end">Actions</th>
              </tr>
            </thead>
            <tbody>
              {% for m in models %}
              <tr>
                <td>{{ m.id }}</td>
                <td>{{ m.model_name }}</td>
                <td>{{ m.faction }}</td>
                <td>{{ "Yes" if m.painted else "No" }}</td>
                <td>{{ m.models_owned }}</td>
                <td class="text-end">

                  <!-- Edit button -->
                  <button
                    class="btn btn-sm btn-outline-light"
                    data-bs-toggle="modal"
                    data-bs-target="#editModal"
                    data-id="{{ m.id }}"
                    data-name="{{ m.model_name }}"
                    data-faction="{{ m.faction }}"
                    data-painted="{{ m.painted }}"
                    data-owned="{{ m.models_owned }}"
                  >Edit</button>

                  <!-- Delete -->
                  <form method="POST" action="{{ url_for('index') }}" class="d-inline-block">
                    <input type="hidden" name="model_id" value="{{ m.id }}">
                    <input type="hidden" name="action" value="delete">
                    <button class="btn btn-sm btn-outline-danger">Delete</button>
                  </form>
                </td>
              </tr>
              {% endfor %}

              {% if not models %}
              <tr>
                <td colspan="6" class="text-center text-secondary py-4">
                  No models found.
                </td>
              </tr>
              {% endif %}
            </tbody>
          </table>
        </div>
      </div>

      <!-- Pagination -->
      <nav class="mt-3 d-flex justify-content-between align-items-center">
        <div class="text-secondary small">
          Page <strong>{{ page }}</strong> of <strong>{{ pages }}</strong> Â· {{ total }} total
        </div>

        <ul class="pagination mb-0">
          <li class="page-item {% if not has_prev %}disabled{% endif %}">
            <a class="page-link" href="{{ url_for('index', page=page-1, per=per_page) if has_prev else '#' }}">Previous</a>
          </li>
          {% for p in range(start_page, end_page + 1) %}
            <li class="page-item {% if p==page %}active{% endif %}">
              <a class="page-link" href="{{ url_for('index', page=p, per=per_page) }}">{{ p }}</a>
            </li>
          {% endfor %}
          <li class="page-item {% if not has_next %}disabled{% endif %}">
            <a class="page-link" href="{{ url_for('index', page=page+1, per=per_page) if has_next else '#' }}">Next</a>
          </li>
        </ul>
      </nav>

    </div>


    <!-- Edit Modal -->
    <div class="modal fade" id="editModal" tabindex="-1">
      <div class="modal-dialog">
        <form method="POST" action="{{ url_for('index') }}" class="modal-content bg-secondary text-light">
          <input type="hidden" name="action" value="update">
          <input type="hidden" name="model_id" id="edit-id">

          <div class="modal-header">
            <h5 class="modal-title text-warning">Edit Model</h5>
            <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
          </div>

          <div class="modal-body row g-3">

            <div class="col-12">
              <label class="form-label">Model Name</label>
              <input class="form-control" name="model_name" id="edit-name" required>
            </div>

            <div class="col-12">
              <label class="form-label">Faction</label>
              <input class="form-control" name="faction" id="edit-faction" required>
            </div>

            <div class="col-12">
              <label class="form-label">Painted</label>
              <select class="form-control" name="painted" id="edit-painted">
                <option value="0">No</option>
                <option value="1">Yes</option>
              </select>
            </div>

            <div class="col-12">
              <label class="form-label">Models Owned</label>
              <input class="form-control" type="number" name="models_owned" id="edit-owned" required>
            </div>

          </div>

          <div class="modal-footer">
            <button class="btn btn-outline-light" type="button" data-bs-dismiss="modal">Cancel</button>
            <button class="btn btn-warning" type="submit">Save Changes</button>
          </div>
        </form>
      </div>
    </div>


    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>

    <script>
      const editModal = document.getElementById("editModal");
      if (editModal) {
        editModal.addEventListener("show.bs.modal", function (event) {
          const btn = event.relatedTarget;
          document.getElementById("edit-id").value = btn.getAttribute("data-id");
          document.getElementById("edit-name").value = btn.getAttribute("data-name");
          document.getElementById("edit-faction").value = btn.getAttribute("data-faction");
          document.getElementById("edit-painted").value = btn.getAttribute("data-painted");
          document.getElementById("edit-owned").value = btn.getAttribute("data-owned");
        });
      }
    </script>

  </body>
</html>
